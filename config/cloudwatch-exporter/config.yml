---
apiVersion: v1alpha1
discovery:
  exportedTagsOnMetrics:
    ec2:
      - Name
    rds:
      - Name
  jobs:
    - type: "ec2"
      regions:
        - (( grab $AWS_REGION ))
      searchTags:
        - key: deploy_env
          value: (( concat "^" $DEPLOY_ENV "$" ))
      metrics:
        - name: CPUCreditBalance
          statistics:
            - Minimum
          period: 60
          length: 600
      addCloudwatchTimestamp: true
    - type: "rds"
      regions:
        - (( grab $AWS_REGION ))
      searchTags:
        - key: deploy_env
          value: (( concat "^" $DEPLOY_ENV "$" ))
      metrics:
        - name: FreeStorageSpace
          statistics:
            - Minimum
          period: 60
          length: 600
        - name: CPUCreditBalance
          statistics:
            - Minimum
          period: 60
          length: 600
      dimensionNameRequirements:
      - DBInstanceIdentifier
      addCloudwatchTimestamp: true
    - type: "AWS/WAFV2"
      regions:
        - (( grab $AWS_REGION ))
      searchTags:
        - key: deploy_env
          value: (( concat "^" $DEPLOY_ENV "$" ))
      metrics:
        - name: AllowedRequests
          statistics:
            - Average
            - Maximum
          period: 60
          length: 600
        - name: BlockedRequests
          statistics:
            - Average
            - Maximum
          period: 60
          length: 600
      dimensionNameRequirements:
      - WebACL
      - Rule
      - Region
      addCloudwatchTimestamp: true
