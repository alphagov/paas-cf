---
- type: replace
  path: /releases/-
  value:
    name: paas-ssm-secrets-poc
    version: 0.0.1635962240
    url: https://s3-eu-west-1.amazonaws.com/gds-paas-build-releases/paas-ssm-secrets-poc-0.0.1635962240.tgz
    sha1: a70db4383334e2a1bbdc69f459b1bb4b4e8c9a35

- type: replace
  path: /instance_groups/-
  value:
    name: secrets_poc
    azs: [z1]
    instances: 1
    vm_type: small
    vm_extensions:
      - paas_secrets_poc
    stemcell: default
    networks:
      - name: cf

- type: replace
  path: /instance_groups/name=secrets_poc/jobs?/-
  value:
    name: ssm-secrets
    release: paas-ssm-secrets-poc
    properties:
      ssm-secrets:
        bearer_auth_host: "0.0.0.0"
        bearer_auth_port: "8080"
        bearer_auth_tls_cert: |
          ((paas_secrets_bearer_auth_tls_cert.certificate))
        bearer_auth_tls_key: |
          ((paas_secrets_bearer_auth_tls_cert.private_key))
        cert_auth_host: "0.0.0.0"
        cert_auth_port: "9090"
        cert_auth_tls_cert: |
          ((paas_secrets_cert_auth_tls_cert.certificate))
        cert_auth_tls_key: |
          ((paas_secrets_cert_auth_tls_cert.private_key))
        cert_auth_trusted_ca_bundle: |
          ((diego_instance_identity_ca.certificate))
          ((diego_instance_identity_ca.ca))
        cf_api_url: "https://api.((terraform_outputs_cf_root_domain))"
        cf_oauth_client_name: "paas-secrets-api"
        cf_oauth_client_secret: "((secrets_uaa_clients_paas_secrets_api_secret))"
        jwt_issuer_url: "https://uaa.((terraform_outputs_cf_root_domain))/oauth/token"
        kms_key_id: "((terraform_outputs_paas_secrets_kms_key_id))"
        ssm_key_prefix: "secrets-poc/((environment))"

- type: replace
  path: /variables/-
  value:
    name: paas_secrets_bearer_auth_tls_cert
    type: certificate
    update_mode: converge
    options:
      is_ca: false
      common_name: "paas_secrets_bearer_auth"
      alternative_names: ["paas_secrets_bearer_auth"]
      duration: 365
      ca: "service_cf_internal_ca"

- type: replace
  path: /variables/-
  value:
    name: paas_secrets_cert_auth_tls_cert
    type: certificate
    update_mode: converge
    options:
      is_ca: false
      common_name: "paas_secrets_cert_auth"
      alternative_names: ["apps.secrets.((system_domain))"]
      duration: 365
      ca: "application_ca"
