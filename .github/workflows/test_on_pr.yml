on: pull_request

env:
  TF_VERSION: "1.0.8"
  BOSH_CLI_VERSION: "2.0.48"
  PROMETHEUS_VERSION: "2.6.1"
  DEPLOY_ENV: "github"
  SHELLCHECK_VERSION: "0.7.1"
  GO_VERSION: "1.17"
  RUBY_VERSION: "2.7"

jobs:
  lint:
    uses: alphagov/paas-cf/.github/workflows/prepare-unit-test-environment.yml@main
    with:
      bosh_cli_version: ${{ env.BOSH_CLI_VERSION }}
      go_version: ${{ env.GO_VERSION }}
      prometheus_version: ${{ env.PROMETHEUS_VERSION }}
      ruby_version: ${{ env.RUBY_VERSION }}
      shellcheck_version: ${{ env.SHELLCHECK_VERSION }}
      terraform_version:  ${{ env.TF_VERSION }}
      test_to_run: "lint"

  config:
    uses: alphagov/paas-cf/.github/workflows/prepare-unit-test-environment.yml@main
    with:
      bosh_cli_version: ${{ env.BOSH_CLI_VERSION }}
      go_version: ${{ env.GO_VERSION }}
      prometheus_version: ${{ env.PROMETHEUS_VERSION }}
      ruby_version: ${{ env.RUBY_VERSION }}
      shellcheck_version: ${{ env.SHELLCHECK_VERSION }}
      terraform_version:  ${{ env.TF_VERSION }}
      test_to_run: "config_spec"

  scripts:
    uses: alphagov/paas-cf/.github/workflows/prepare-unit-test-environment.yml@main
    with:
      bosh_cli_version: ${{ env.BOSH_CLI_VERSION }}
      go_version: ${{ env.GO_VERSION }}
      prometheus_version: ${{ env.PROMETHEUS_VERSION }}
      ruby_version: ${{ env.RUBY_VERSION }}
      shellcheck_version: ${{ env.SHELLCHECK_VERSION }}
      terraform_version:  ${{ env.TF_VERSION }}
      test_to_run: "scripts_spec"

  tools:
    uses: alphagov/paas-cf/.github/workflows/prepare-unit-test-environment.yml@main
    with:
      bosh_cli_version: ${{ env.BOSH_CLI_VERSION }}
      go_version: ${{ env.GO_VERSION }}
      prometheus_version: ${{ env.PROMETHEUS_VERSION }}
      ruby_version: ${{ env.RUBY_VERSION }}
      shellcheck_version: ${{ env.SHELLCHECK_VERSION }}
      terraform_version:  ${{ env.TF_VERSION }}
      test_to_run: "tools_spec"

  concourse:
    uses: alphagov/paas-cf/.github/workflows/prepare-unit-test-environment.yml@main
    with:
      bosh_cli_version: ${{ env.BOSH_CLI_VERSION }}
      go_version: ${{ env.GO_VERSION }}
      prometheus_version: ${{ env.PROMETHEUS_VERSION }}
      ruby_version: ${{ env.RUBY_VERSION }}
      shellcheck_version: ${{ env.SHELLCHECK_VERSION }}
      terraform_version:  ${{ env.TF_VERSION }}
      test_to_run: "concourse_spec"

  manifests:
    uses: alphagov/paas-cf/.github/workflows/prepare-unit-test-environment.yml@main
    with:
      bosh_cli_version: ${{ env.BOSH_CLI_VERSION }}
      go_version: ${{ env.GO_VERSION }}
      prometheus_version: ${{ env.PROMETHEUS_VERSION }}
      ruby_version: ${{ env.RUBY_VERSION }}
      shellcheck_version: ${{ env.SHELLCHECK_VERSION }}
      terraform_version:  ${{ env.TF_VERSION }}
      test_to_run: "manifests_spec"

  test_terraform:
    uses: alphagov/paas-cf/.github/workflows/prepare-unit-test-environment.yml@main
    with:
      bosh_cli_version: ${{ env.BOSH_CLI_VERSION }}
      go_version: ${{ env.GO_VERSION }}
      prometheus_version: ${{ env.PROMETHEUS_VERSION }}
      ruby_version: ${{ env.RUBY_VERSION }}
      shellcheck_version: ${{ env.SHELLCHECK_VERSION }}
      terraform_version:  ${{ env.TF_VERSION }}
      test_to_run: "terraform_spec"

  platform_tests:
    uses: alphagov/paas-cf/.github/workflows/prepare-unit-test-environment.yml@main
    with:
      bosh_cli_version: ${{ env.BOSH_CLI_VERSION }}
      go_version: ${{ env.GO_VERSION }}
      prometheus_version: ${{ env.PROMETHEUS_VERSION }}
      ruby_version: ${{ env.RUBY_VERSION }}
      shellcheck_version: ${{ env.SHELLCHECK_VERSION }}
      terraform_version:  ${{ env.TF_VERSION }}
      test_to_run: "platform_tests_spec"

  compile_platform_tests:
    uses: alphagov/paas-cf/.github/workflows/prepare-unit-test-environment.yml@main
    with:
      bosh_cli_version: ${{ env.BOSH_CLI_VERSION }}
      go_version: ${{ env.GO_VERSION }}
      prometheus_version: ${{ env.PROMETHEUS_VERSION }}
      ruby_version: ${{ env.RUBY_VERSION }}
      shellcheck_version: ${{ env.SHELLCHECK_VERSION }}
      terraform_version:  ${{ env.TF_VERSION }}
      test_to_run: "compile_platform_tests"
